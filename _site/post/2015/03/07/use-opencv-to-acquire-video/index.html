<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Use OpenCV to acquire video &middot; Robert Cudmore
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!--
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  -->
  
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>





  <body class="layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">

    
    
    <div id="sidebar">
    <!-- <nav class="sidebar-nav"> -->
      <!-- <a class="sidebar-nav-item" href="">Home</a> -->

      

	  <script>
  (function() {
    var cx = '014838221913568838622:5bpsoltbvmg';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>


		<section id="article">
		  <span class="sidebar-nav-item">Recent posts</span>
		    
		      &raquo; <a class="sidebarlink" href="/post/2015/05/05/mounting-a-usb-drive-at-boot/">Mounting a USB drive at boot</a><BR>
		    
		      &raquo; <a class="sidebarlink" href="/post/2015/05/05/X11%20on%20Raspberry/">X11 on raspberry</a><BR>
		    
		      &raquo; <a class="sidebarlink" href="/post/2015/05/04/Auto-login-to-ssh-server/">Auto login to ssh servers</a><BR>
		    
		      &raquo; <a class="sidebarlink" href="/post/2015/04/30/python-tricks/">Python tricks</a><BR>
		    
		      &raquo; <a class="sidebarlink" href="/post/2015/04/29/vnc-on-raspberry/">VNC on raspberry pi</a><BR>
		    
		</section>

		<BR>

		<span class="sidebar-nav-item">Tag cloud</span>
		
    		<a style="font-size: 70%" href="/tags/#flask">
    		  flask
    		</a>
		
    		<a style="font-size: 101%" href="/tags/#python">
    		  python
    		</a>
		
    		<a style="font-size: 116%" href="/tags/#raspberry pi">
    		  raspberry pi
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#bokeh">
    		  bokeh
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#video">
    		  video
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#acquisition">
    		  acquisition
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#opencv">
    		  opencv
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#raspian">
    		  raspian
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#protocols">
    		  protocols
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#osx">
    		  osx
    		</a>
		
    		<a style="font-size: 86%" href="/tags/#raspberry">
    		  raspberry
    		</a>
		
    		<a style="font-size: 86%" href="/tags/#linux">
    		  linux
    		</a>
		
    		<a style="font-size: 55%" href="/tags/#OSX">
    		  OSX
    		</a>
		

		<BR>
		<BR>

		<section id="article">
		  <span class="sidebar-nav-item">Links</span>
		  &raquo; <a class="sidebarlink" href="http://robertcudmore.org">Homepage</a><BR>
		  &raquo; <a class="sidebarlink" href="https://github.com/cudmore/cudmore.github.io">Blog layout on github</a><BR>
		  &raquo; <a class="sidebarlink" href="http://www.flickr.com/cudmore">Flickr</a><BR>
		</section>
  
	</div>
<!--    </nav> -->

  </div>
</div>


    <div class="content container">

      <!-- added by bob -->
      <div class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Robert Cudmore</a>

          
              &nbsp;&nbsp;&nbsp;<small><a href="/about">about</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/archive">archive</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/tags">tags</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/software">software</a></small>
          


        </h3>
		<hr style="background:#202020; border:0; height:3px" />
      </div>

      <div class="post">
  <h3 class="post-title">Use OpenCV to acquire video</h1>
  <span class="post-date">07 Mar 2015</span>
  <h4>Goals</h4>

<ul>
<li>Use raspberry to record video from USB camera and stream to disk.</li>
<li>Use python and opencv</li>
<li>will save either as a sequence of .tif or as an uncompressed videofile</li>
</ul>

<h4>Install opencv</h4>

<blockquote>
<p>sudo apt-get update<br>
sudo apt-get upgrade<br>
sudo apt-get install libopencv-dev python-opencv</p>
</blockquote>

<ul>
<li>Remember that I have conda install of python in &#39;/home/pi/miniconda/bin/python&#39;.</li>
<li>I need to use &#39;/usr/bin/python&#39; instead.</li>
</ul>

<h4>Check opencv install</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">pi@pi40 ~ $ /usr/bin/python  
Python 2.7.3 (default, Mar 18 2014, 05:13:23) 
[GCC 4.6.3] on linux2  
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.  
&gt;&gt;&gt; import cv2  
&gt;&gt;&gt; cv2.__version__  
&#39;2.4.1&#39;
</code></pre></div>
<h4>Install USB thumb drive + usb camera</h4>

<ul>
<li><p>after pluggin in usb drive + usb camera</p>

<p>pi@pi40 ~ $ lsusb<br>
Bus 001 Device 002: ID 0424:9512 Standard Microsystems Corp. 
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub<br>
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. 
Bus 001 Device 005: ID 1415:2000 Nam Tai E&amp;E Products Ltd. or OmniVision Technologies, Inc. Sony Playstation Eye<br>
Bus 001 Device 004: ID 13fe:4100 Kingston Technology Company Inc.  </p></li>
</ul>

<h4>Got some python/opencv code to acquire</h4>

<ul>
<li>Acquires individual .tif files in a loop</li>
</ul>

<h4>To do</h4>

<ul>
<li>Check the frame rate by recording a clock</li>
<li>Add in template code for stop/start, start with keyboard and then move to GPIO</li>
<li>Get the DC60 STK1160 video to usb dongle working</li>
<li>This website says that it may just auto detect in newer linux kernels?
<a href="http://linuxtv.org/wiki/index.php/Stk1160#Making_it_Work">http://linuxtv.org/wiki/index.php/Stk1160#Making_it_Work</a></li>
</ul>

<h4>Here is the code</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">#/usr/bin/python

import numpy as np
import cv2

#initialize camera
cap = cv2.VideoCapture(0)
if cap is None:
    print &#39;Warning: unable to access camera&#39;

#stopPin = 7 # listen for a change on this pin to stop

# number of frames to acquire
numFrames = 30
currFrame = 0

#outfilebase = &#39;images/image&#39; #append number + .tif

print &#39;starting capture of &#39; + str(numFrames) + &#39; frames.&#39;
print &#39;press ctrl-c to stop ... eventually we will stop on a TTL&#39;
while(cap.isOpened()):
    try:
        ret, frame = cap.read()
        if ret==True:
            #flip frame
            #frame = cv2.flip(frame,0)

            #print frame.shape

            # write the flipped frame
            try:
                #out.write(frame)
                #cv2.SaveImage(&#39;file&#39; + str(currFrame) + &#39;.tif&#39;, frame)
                cv2.imwrite(&#39;images/image&#39; + str(currFrame) + &#39;.tif&#39;, frame)
            except:
                print &#39;Error in out.write() OR user hit ctrl-c&#39;
                break

            currFrame += 1
            #if (currFrame &gt; numFrames):
            #    print &#39;finished &#39; + str(numFrames) + &#39; frames.&#39;
            #    break

        else:
            break

    except KeyboardInterrupt:
        print &#39;user hit ctrl-c&#39;
        print &#39;frames=&#39; + str(currFrame)
        break

# Release camera
cap.release()
</code></pre></div>
</div>

<div class="post-tags">
  Tags: 
  
    
  
  
  <a href="/tags/#video">video</a>,
  
  <a href="/tags/#acquisition">acquisition</a>,
  
  <a href="/tags/#opencv">opencv</a>
  
</div>


<div class="post-tags">
    <p><font size="-1rem">&copy;2015. <A HREF="http://robertcudmore.org">Robert Cudmore</A>.</font></p>
</div>


<span class="page-nav-item-left">
    <a rel="prev" href="/post/2015/03/05/bokeh-on-the-raspberry-pi/" title="View Plotting with bokeh on the Raspberry Pi">&laquo; Previous</a>
</span>


<span class="page-nav-item-right">
    <a rel="next" href="/post/2015/03/15/Installing-mjpg-streamer-on-a-raspberry-pi/" title="View ">Next &raquo;</a>
</span>



    </div>

  </body>
</html>
