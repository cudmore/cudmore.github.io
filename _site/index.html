<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Robert Cudmore &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>





  <body class="layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">

    
    
    <div id="sidebar">
    <!-- <nav class="sidebar-nav"> -->
      <!-- <a class="sidebar-nav-item" href="">Home</a> -->

      

		<section id="article">
		  <span class="sidebar-nav-item">Recent posts</span>
		    
		      &raquo; <a href="/post/2015/03/07/use-opencv-to-acquire-video/">Use OpenCV to acquire video</a><BR>
		    
		      &raquo; <a href="/post/2015/03/05/bokeh-on-the-raspberry-pi/">Plotting with bokeh on the Raspberry Pi</a><BR>
		    
		      &raquo; <a href="/2015/02/15/my-post-2/">My post 2</a><BR>
		    
		      &raquo; <a href="/2015/02/14/First-post-in-Jekyll/">First post in Jekyll</a><BR>
		    
		      &raquo; <a href="/2014/12/24/Python-calling-bash-to-get-drive-space-remaining/">Python calling bash to get drive space remaining</a><BR>
		    
		</section>

		<BR>

		<span class="sidebar-nav-item">Tag cloud</span>
		
    		<a style="font-size: 123%" href="/tags/#jekyll">
    		  jekyll
    		</a>
		
    		<a style="font-size: 106%" href="/tags/#example">
    		  example
    		</a>
		
    		<a style="font-size: 90%" href="/tags/#remove">
    		  remove
    		</a>
		
    		<a style="font-size: 73%" href="/tags/#python">
    		  python
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#To Do">
    		  To Do
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#another tag 1">
    		  another tag 1
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#bokeh">
    		  bokeh
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#flask">
    		  flask
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#raspberry pi">
    		  raspberry pi
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#video">
    		  video
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#acquisition">
    		  acquisition
    		</a>
		
    		<a style="font-size: 56%" href="/tags/#opencv">
    		  opencv
    		</a>
		

		<BR>
		<BR>

		<section id="article">
		  <span class="sidebar-nav-item">Links</span>
		  &raquo; <a href="http://robertcudmore.org">Homepage</a><BR>
		  &raquo; <a href="https://github.com/cudmore/cudmore.github.io">Blog layout on github</a><BR>
		  &raquo; <a href="http://www.flickr.com/cudmore">Flickr</a><BR>
		</section>
  
	</div>
<!--    </nav> -->

  </div>
</div>


    <div class="content container">

      <!-- added by bob -->
      <div class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Robert Cudmore</a>

          
              &nbsp;&nbsp;&nbsp;<small><a href="/about">about</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/archive">archive</a></small>
          
              &nbsp;&nbsp;&nbsp;<small><a href="/tags">tags</a></small>
          

        </h3>
		<hr style="background:#202020; border:0; height:3px" />
      </div>

      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/post/2015/03/07/use-opencv-to-acquire-video/">
        Use OpenCV to acquire video
      </a>
    </h1>

    <span class="post-date">07 Mar 2015</span>

    <h4>Goals</h4>

<ul>
<li>Use raspberry to record video from USB camera and stream to disk.</li>
<li>Use python and opencv</li>
<li>will save either as a sequence of .tif or as an uncompressed videofile</li>
</ul>

<h4>Install opencv</h4>

<blockquote>
<p>sudo apt-get update<br>
sudo apt-get upgrade<br>
sudo apt-get install libopencv-dev python-opencv</p>
</blockquote>

<ul>
<li>Remember that I have conda install of python in &#39;/home/pi/miniconda/bin/python&#39;.</li>
<li>I need to use &#39;/usr/bin/python&#39; instead.</li>
</ul>

<h4>Check opencv install</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">pi@pi40 ~ $ /usr/bin/python  
Python 2.7.3 (default, Mar 18 2014, 05:13:23) 
[GCC 4.6.3] on linux2  
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.  
&gt;&gt;&gt; import cv2  
&gt;&gt;&gt; cv2.__version__  
&#39;2.4.1&#39;
</code></pre></div>
<h4>Install USB thumb drive + usb camera</h4>

<ul>
<li><p>after pluggin in usb drive + usb camera</p>

<p>pi@pi40 ~ $ lsusb<br>
Bus 001 Device 002: ID 0424:9512 Standard Microsystems Corp. 
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub<br>
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. 
Bus 001 Device 005: ID 1415:2000 Nam Tai E&amp;E Products Ltd. or OmniVision Technologies, Inc. Sony Playstation Eye<br>
Bus 001 Device 004: ID 13fe:4100 Kingston Technology Company Inc.  </p></li>
</ul>

<h4>Got some python/opencv code to acquire</h4>

<ul>
<li>Acquires individual .tif files in a loop</li>
</ul>

<h4>To do</h4>

<ul>
<li>Check the frame rate by recording a clock</li>
<li>Add in template code for stop/start, start with keyboard and then move to GPIO</li>
<li>Get the DC60 STK1160 video to usb dongle working</li>
<li>This website says that it may just auto detect in newer linux kernels?
http://linuxtv.org/wiki/index.php/Stk1160#Making<em>it</em>Work</li>
</ul>

<h4>Here is the code</h4>
<div class="highlight"><pre><code class="language-text" data-lang="text">#/usr/bin/python

import numpy as np
import cv2

#initialize camera
cap = cv2.VideoCapture(0)
if cap is None:
    print &#39;Warning: unable to access camera&#39;

#stopPin = 7 # listen for a change on this pin to stop

# number of frames to acquire
numFrames = 30
currFrame = 0

#outfilebase = &#39;images/image&#39; #append number + .tif

print &#39;starting capture of &#39; + str(numFrames) + &#39; frames.&#39;
print &#39;press ctrl-c to stop ... eventually we will stop on a TTL&#39;
while(cap.isOpened()):
    try:
        ret, frame = cap.read()
        if ret==True:
            #flip frame
            #frame = cv2.flip(frame,0)

            #print frame.shape

            # write the flipped frame
            try:
                #out.write(frame)
                #cv2.SaveImage(&#39;file&#39; + str(currFrame) + &#39;.tif&#39;, frame)
                cv2.imwrite(&#39;images/image&#39; + str(currFrame) + &#39;.tif&#39;, frame)
            except:
                print &#39;Error in out.write() OR user hit ctrl-c&#39;
                break

            currFrame += 1
            #if (currFrame &gt; numFrames):
            #    print &#39;finished &#39; + str(numFrames) + &#39; frames.&#39;
            #    break

        else:
            break

    except KeyboardInterrupt:
        print &#39;user hit ctrl-c&#39;
        print &#39;frames=&#39; + str(currFrame)
        break

# Release camera
cap.release()
</code></pre></div>

	<hr style="background:#CCC; border:0; height:2px" />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/post/2015/03/05/bokeh-on-the-raspberry-pi/">
        Plotting with bokeh on the Raspberry Pi
      </a>
    </h1>

    <span class="post-date">05 Mar 2015</span>

    <h3>To get bokeh plotting on the Raspberry Pi</h3>

<ul>
<li>Install continuum anaconda python distribution</li>
<li>Install bokeh plotting and get a plot server running</li>
<li>be able to run bokeh examples</li>
</ul>

<h3>Install miniconda</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">pi@pi40 ~ $ wget http://repo.continuum.io/miniconda/Miniconda-3.5.5-Linux-armv6l.sh
pi@pi40 ~ $ bash Miniconda-3.5.5-Linux-armv6l.sh 

Miniconda will now be installed into this location:
/home/pi/miniconda

  - Press ENTER to confirm the location
  - Press CTRL-C to abort the installation
  - Or specify an different location below

[/home/pi/miniconda] &gt;&gt;&gt; 
PREFIX=/home/pi/miniconda
installing: python-2.7.7-0 ...
installing: openssl-1.0.1h-0 ...
installing: pycosat-0.6.1-py27_0 ...
installing: pyyaml-3.11-py27_0 ...
installing: requests-2.3.0-py27_0 ...
installing: yaml-0.1.4-0 ...
installing: conda-3.5.5-py27_0 ...
Python 2.7.7 :: Continuum Analytics, Inc.
creating default environment...
installation finished.
Do you wish the installer to prepend the Miniconda install location
to PATH in your /home/pi/.bashrc ? [yes|no]
[no] &gt;&gt;&gt; yes

Prepending PATH=/home/pi/miniconda/bin to PATH in /home/pi/.bashrc
A backup will be made to: /home/pi/.bashrc-miniconda.bak


For this change to become active, you have to open a new terminal.

Thank you for installing Miniconda!
</code></pre></div>
<h3>Make sure numpy and pandas is correct</h3>

<blockquote>
<p>pip install numpy --upgrade<br>
pip install pandas --upgrade  </p>
</blockquote>

<h3>Install bokeh</h3>

<p>In general &#39;conda install bokeh&#39; does not work on Pi, bokeh is not in repo?</p>

<blockquote>
<p>pip install bokeh  </p>
</blockquote>

<p>For a list of required packages, see http://bokeh.pydata.org/en/latest/tutorial/quick_install.html  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">from: http://bokeh.pydata.org/en/latest/tutorial/quick_install.html
Ideally, you should have the following libraries installed:

NumPy
Flask
Redis
Requests
gevent
gevent-websocket
Pandas
</code></pre></div>
<h3>Currently installed with pip</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">pi@pi40 ~ $ pip freeze
Flask==0.10.1
Flask-Markdown==0.3
Flask-Misaka==0.3.0
Flask-SocketIO==0.5.0
Jinja2==2.7.3
Markdown==2.6
MarkupSafe==0.23
PyYAML==3.11
Pygments==2.0.2
RPi.GPIO==0.5.11
Werkzeug==0.10.1
backports.ssl-match-hostname==3.4.0.2
bokeh==0.8.1
colorama==0.3.3
conda==3.5.5
gevent==1.0.1
gevent-socketio==0.3.6
gevent-websocket==0.9.3
greenlet==0.4.5
ipython==2.1.0
itsdangerous==0.24
misaka==1.0.2
nose==1.3.0
numpy==1.9.2
pandas==0.15.2
psutil==2.2.1
pycosat==0.6.1
pystache==0.5.4
python-dateutil==2.4.1
pytz==2014.10
pyzmq==14.5.0
requests==2.3.0
six==1.9.0
tornado==4.1
websocket==0.2.1
wsgiref==0.1.2
</code></pre></div>
<h3>Grab some example plots from bokeh github</h3>

<p>The bokeh example plots are at:</p>

<blockquote>
<p>https://github.com/bokeh/bokeh/tree/master/examples/plotting/server</p>
</blockquote>

<h3>Run the bokeh-server</h3>

<p>Remember, this make temporary files in directory you run it in.</p>

<p>--ip 0.0.0.0 will redirect the server to your external IP, in my case http://192.168.1.40:5006  </p>

<blockquote>
<p>bokeh-server --backend=memory --ip 0.0.0.0</p>
</blockquote>
<div class="highlight"><pre><code class="language-text" data-lang="text">pi@pi40 ~/bokeh_examples $ bokeh-server --backend=memory --ip 0.0.0.0
No module named scipy

    Bokeh Server Configuration
    ==========================
    python version : 2.7.8
    bokeh version  : 0.8.1
    listening      : 0.0.0.0:5006
    backend        : memory
    python options : debug:OFF, verbose:OFF, filter-logs:OFF, multi-user:OFF
    js options     : splitjs:OFF, debugjs:OFF

/home/pi/miniconda/lib/python2.7/site-packages/bokeh/server/blaze/__init__.py:19: UserWarning: could not import multiuser blaze server No module named blaze.  This is fine if you do not intend to use blaze capabilities in the bokeh server
  warnings.warn(msg)
</code></pre></div>
<h3>Example plots I have working</h3>

<p>line_animate.py</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># The plot server must be running
# Go to http://localhost:5006/bokeh to view this plot

import time

import numpy as np

from bokeh.plotting import *

N = 80

x = np.linspace(0, 4*np.pi, N)
y = np.sin(x)

output_server(&quot;line_animate&quot;)

p = figure()

p.line(x, y, color=&quot;#3333ee&quot;, name=&quot;sin&quot;)
p.line([0,4*np.pi], [-1, 1], color=&quot;#ee3333&quot;)

show(p)

renderer = p.select(dict(name=&quot;sin&quot;))
ds = renderer[0].data_source

while True:
    for i in np.hstack((np.linspace(1, -1, 100), np.linspace(-1, 1, 100))):
        ds.data[&quot;y&quot;] = y * i
        cursession().store_objects(ds)
        time.sleep(0.05)
</code></pre></div>
<h3>Now use Flask + bokeh to generate a single html page (no bokeh-server)</h3>

<ul>
<li>eventual goal here is to have Flask server inject new data (via socketio) into html page with bokeh plot by modifying x/y data with javascript (on the client)</li>
<li>simple example that works: https://github.com/bokeh/bokeh/tree/master/examples/embed/simple<br></li>
<li>more complex: https://github.com/bokeh/bokeh/tree/master/examples/embed/spectrogram</li>
</ul>

<h3>Links</h3>

<ul>
<li>http://bokeh.pydata.org/en/latest/index.html<br></li>
<li>http://docs.continuum.io/anaconda/install.html<br></li>
</ul>


	<hr style="background:#CCC; border:0; height:2px" />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/02/15/my-post-2/">
        My post 2
      </a>
    </h1>

    <span class="post-date">15 Feb 2015</span>

    <h4>heading 4 ... This is my first blog post in Jekyll</h4>

<p>xxx and yyy is a paragraph.</p>

<h5>heading 5</h5>

<p>another paragraphs.</p>

<ul>
<li>list item 1<br></li>
<li>list item 2</li>
</ul>


	<hr style="background:#CCC; border:0; height:2px" />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/02/14/First-post-in-Jekyll/">
        First post in Jekyll
      </a>
    </h1>

    <span class="post-date">14 Feb 2015</span>

    <h4>This is my first blog post in Jekyll</h4>

<p>Grab layout from  </p>

<blockquote>
<p>http://mikerowecode.com</p>

<p>https://github.com/mrowe/mrowe.github.com</p>
</blockquote>


	<hr style="background:#CCC; border:0; height:2px" />
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/12/24/Python-calling-bash-to-get-drive-space-remaining/">
        Python calling bash to get drive space remaining
      </a>
    </h1>

    <span class="post-date">24 Dec 2014</span>

    <p>I need to have some Python code tell me how much drive space is left. Here is what I came up with.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt;&gt;&gt; import subprocess as sub
&gt;&gt;&gt; checkPath = &#39;~/video&#39;
&gt;&gt;&gt; cmd = &quot;df &quot; + checkPath + &quot; | awk &#39;{ print $5 }&#39; | tail -n 1&quot;
&gt;&gt;&gt; p = sub.Popen(cmd, stdout=sub.PIPE,stderr=sub.PIPE, shell=True)
&gt;&gt;&gt; (out, err) = p.communicate()
&gt;&gt;&gt; out
&#39;31%\n&#39;
&gt;&gt;&gt; out.rstrip() #rstrip &#39;chomps&#39; off newline
&#39;31%&#39;
</code></pre></div>

	<hr style="background:#CCC; border:0; height:2px" />
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>
    </div>

  </body>
</html>
